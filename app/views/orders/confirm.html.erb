<div class="container">
	<div class="row mx-2">
		<div class="ec-cart-index-main col-md-12">
			<h2 class="ec-cart-index-title">Order Confirmation</h2>

			<div class="cart-item-table row">
				<table class="table01 table table-sm col-12" style="border-bottom: 2px solid  #F0EDEC;">
          <thead>
            <tr class="active">
              <th colspan="2">Product name</th>
              <th class="text-center">Unit price</th>
              <th class="text-center">Amount</th>
              <th class="text-center">Subtotal</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
          	<% current_user.cart_items.each do |cart_item| %>
            	<tr>
                <th><%= attachment_image_tag cart_item.item, :image, size: "100x100", fallback: "no-image.jpeg", format: "jpeg", class: "card" %></th>
                <td data-label="Product name" class="text-center"><p><%= cart_item.item.item_name %></p></td>
                <td data-label="Unit price" class="text-center"><p>$ <%= number_with_precision(cart_item.item.price, precision: 2) %></p></td>
                <td data-label="Amount" class="text-center"><p><%= cart_item.amount %></p></td>
                <td data-label="Subtotal" class="text-center"><p>$ <%= number_with_precision(cart_item.subtotal_price, precision: 2) %></p></td><!-- cart_item.subtotal_priceはcart_item.rbに記載 -->
              </tr>
            <% end %>
          </tbody>
        </table>
          
        <div class="confirm-prise col-md-5 offset-md-7 mt-3">
          <table class="table table-bordered">
            <tbody>
              <tr>
                <th class="active">Shipping Cost</th>
                <td class="text-right">$ <%= @shipping_cost.to_s(:delimited) %></td>
              </tr>
              <tr>
                <th class="active">Total Price</th>
                <td class="text-right">$ <%= number_with_precision(current_user.cart_items.inject(0){|sum, cart_item| cart_item.subtotal_price + sum}, precision: 2)  %></td>
              </tr>
              <tr>
                <th class="active">Grand Total</th>
                <td class="text-right">$ <%= @order.total_payment.to_s(:delimited) %></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div> 
    
        <table class="table table-bordered mb-5">
          <tr>
            <th class="active">Shipping Method</th>
            <td class="text-left">
              <% if @order.shipping_method == "Includes_tracking" %>
                 Includes tracking (SP)
              <% else %>  
                 DHL / FedEx
              <% end %>
            </td>
          </tr>
          <tr>
            <th class="active">Payment Method</th>
            <td class="text-left">
              <% if @order.payment_method == "Creditcard" %>
                 Credit Card
              <% else %>  
                 Paypal
              <% end %>
            </td>
          </tr>
          <tr>
            <th class="col-xs-4 active">Shipping Address</th>
            <td class="col-xs-8">
              <%= @order.first_name %> <%= @order.last_name %> <%= @order.address %> <%= @order.city %> <%= @order.postal_code %> <%= @order.country %><br>
            </td>
          </tr>
        </table>
     
      <div class="comfirmation-btn-wrap text-center mb-5">
        <%= form_with model: @order, local:true do |f| %>
          <%= f.hidden_field :postal_code, value: @order.postal_code %>
          <%= f.hidden_field :total_payment, value: @order.total_payment %>
          <%= f.hidden_field :address, value: @order.address %>
          <%= f.hidden_field :last_name, value: @order.last_name %>
          <%= f.hidden_field :first_name, value: @order.first_name %>
          <%= f.hidden_field :payment_method, value: @order.payment_method %>
          <%= f.submit "Procced to payment", class:"btn btn-primary" %>
        <% end %>
        <%#= link_to "購入を確定する", orders_path(@order), method: :post, class:"btn btn-primary" %>
      </div>
 
</div>
</div>